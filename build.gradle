import de.gesellix.gradle.docker.tasks.DockerInfoTask
import de.gesellix.gradle.docker.tasks.DockerPingTask
import de.gesellix.gradle.docker.tasks.DockerVersionTask

import static groovy.json.JsonOutput.prettyPrint
import static groovy.json.JsonOutput.toJson

buildscript {
  repositories {
    mavenLocal()
    jcenter()
//    maven { url 'http://dl.bintray.com/gesellix/docker-utils' }
    maven { url "https://plugins.gradle.org/m2/" }
  }
// works with Gradle < 2.1
//  dependencies {
//    classpath 'com.github.ben-manes:gradle-versions-plugin:0.11.3'
//    classpath 'de.gesellix:gradle-docker-plugin:2015-11-04T20-33-08'
//  }
}
//apply plugin: 'com.github.ben-manes.versions'
//apply plugin: "de.gesellix.docker"

// works with Gradle 2.1+, for the old configuration see http://plugins.gradle.org/plugin/de.gesellix.docker
plugins {
  id "com.github.ben-manes.versions" version "0.11.3"
  id "de.gesellix.docker" version "2015-11-04T21-33-37"
}

ext {
//  localDockerHost = "unix:///var/run/docker.sock"
//  localDockerHost = 'https://192.168.99.100:2376'
  localDockerHost = System.env.DOCKER_HOST
//  remoteDockerHost = "http://172.17.42.1:2376"
  remoteDockerHost = 'https://192.168.99.100:2376'
}

allprojects {
  apply plugin: 'base'
  apply plugin: "de.gesellix.docker"

  docker {
    dockerHost = localDockerHost
    authConfigPlain = ["username"     : "gesellix",
                       "password"     : "-yet-another-password-",
                       "email"        : "tobias@gesellix.de",
                       "serveraddress": "https://index.docker.io/v1/"]
  }
}

task ping(type: DockerPingTask) {
  doLast {
    println prettyPrint(toJson(result.content))
  }
}

task info(type: DockerInfoTask) {
  doLast {
    println prettyPrint(toJson(info))
  }
}

task version(type: DockerVersionTask) {
  doLast {
    println prettyPrint(toJson(version))
  }
}

task wrapper(type: Wrapper) {
  gradleVersion = '2.8'
  distributionUrl = "http://services.gradle.org/distributions/gradle-${gradleVersion}-all.zip"
}
